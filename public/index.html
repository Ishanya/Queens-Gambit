<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Learn how to use the Firebase platform on the Web">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Queen's Gambit | An Online Chess Platform</title>

  <!-- Chessboard css-->
  <link rel="stylesheet" type="text/css" href="./css/chessboard-0.3.0.css">

  <!-- Material Design Lite -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css">
  <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>

  <!-- App Styling -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
  <link rel="stylesheet" href="styles/main.css">

  <script src="js/jquery.js"></script>
</head>

<body>
  <script src="js/chess.js"></script>
  <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">


  <main class="mdl-layout__content mdl-color--grey-100">
    <div id="messages-card-container" class="mdl-cell mdl-cell--12-col mdl-grid">

      <!-- Messages container -->
      <div id="messages-card" class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--5-col-tablet mdl-cell--5-col-desktop">
        <div class="mdl-card__supporting-text mdl-color-text--grey-600">
          <div id="messages">
            <span id="message-filler"></span>
          </div>
          <form id="message-form" action="#">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <input class="mdl-textfield__input" type="text" id="message">
              <label class="mdl-textfield__label" for="message">Message...</label>
            </div>
            <button id="submit" disabled type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
              Send
            </button>
          </form>
          <form id="image-form" action="#">
            <input id="mediaCapture" type="file" accept="image/*,capture=camera">
            <button id="submitImage" title="Add an image" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--amber-400 mdl-color-text--white">
              <i class="material-icons">image</i>
            </button>
          </form>
        </div>
      </div>
      <div id="messages-card" class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--7-col-tablet mdl-cell--7-col-desktop">

      <!-- Accent-colored raised button with ripple -->
      <button id="creategame" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
        Create a Game
      </button>
      <div id="board"></div>

      <button id="joingame" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
        Join a Game
      </button>
      </div>


      <div id="must-signin-snackbar" class="mdl-js-snackbar mdl-snackbar">
        <div class="mdl-snackbar__text"></div>
        <button class="mdl-snackbar__action" type="button"></button>
      </div>

    </div>
  </main>
</div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="js/chessboard-0.3.0.js"></script>
  <script src="js/gamelogic.js"></script>
  <script>
    var socket = io();

    //on connection to server ask for user's name with an anonymous callback
    socket.on('connect',function(){
      console.log('client successfully connected');
    });

    socket.on('updatechat',function(user, data){
      console.log('updating chat');
      console.log(data);
    });
    socket.on('updateboard',function(user, source, target){
      console.log(user);
      console.log("target : " + target);
      console.log("source : " + source);

      board.move(source + '-' + target);

      var move = game.move({
      from: source,
      to: target,
      promotion: 'q' // NOTE: always promote to a queen for example simplicity
    });
      
      updateStatus();

      function updateStatus() {
          var status = '';

          var moveColor = 'White';
          if (game.turn() === 'b') {
            moveColor = 'Black';
          }

          // checkmate?
          if (game.in_checkmate() === true) {
            status = 'Game over, ' + moveColor + ' is in checkmate.';
          }

          // draw?
          else if (game.in_draw() === true) {
            status = 'Game over, drawn position';
          }

          // game still on
          else {
            status = moveColor + ' to move';

            // check?
            if (game.in_check() === true) {
              status += ', ' + moveColor + ' is in check';
            }
          }

          console.log(status);
          console.log(game.fen());
          console.log(game.pgn());
        };

    });
  </script>

  <script type="text/javascript">
    $("#creategame").on('click', function(){
      socket.emit('play',prompt("What's your name"));
      console.log(Math.random().toString(36).slice(2)); //generating random key
    });

    $("#joingame").on("click", function(){
      socket.emit('join',prompt("What's your name"), prompt("unique key of the game"));
    });
  </script>
  
</body>
</html>
